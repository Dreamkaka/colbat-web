import{h as a}from"./scheduler.y4uHs2UB.js";import{s as n}from"./settings.D2QZNL8x.js";import d from"./lazy-get.slowJJOg.js";import{getSession as l}from"./session.B5AThXCd.js";import{currentApiURL as f}from"./api-url.DxeaKSsF.js";import{c as p,t as m,b as y}from"./turnstile.BJf2cMOv.js";import{getServerInfo as g}from"./server-info.Dtq1Mxeq.js";const b=async()=>{const e=a(n).processing;if(a(m)){if(!a(y))return{status:"error",error:{code:"error.captcha_ongoing"}};const t=await l();if(t)if("error"in t){if(t.error.code!=="error.api.auth.not_configured")return t}else return`Bearer ${t.token}`}if(e.enableCustomApiKey&&e.customApiKey.length>0)return`Api-Key ${e.customApiKey}`},h=async e=>{const t=d(a(n)),u={url:e,downloadMode:t("save","downloadMode"),audioBitrate:t("save","audioBitrate"),audioFormat:t("save","audioFormat"),tiktokFullAudio:t("save","tiktokFullAudio"),youtubeDubLang:t("save","youtubeDubLang"),youtubeVideoCodec:t("save","youtubeVideoCodec"),videoQuality:t("save","videoQuality"),youtubeHLS:t("save","youtubeHLS"),filenameStyle:t("save","filenameStyle"),disableMetadata:t("save","disableMetadata"),twitterGif:t("save","twitterGif"),tiktokH265:t("save","tiktokH265"),alwaysProxy:t("privacy","alwaysProxy")};if(await g(),!a(p))return{status:"error",error:{code:"error.api.unreachable"}};const c=f(),o=await b();if(o&&typeof o!="string")return o;let i={};return o&&(i={Authorization:o}),await fetch(c,{method:"POST",redirect:"manual",signal:AbortSignal.timeout(2e4),body:JSON.stringify(u),headers:{Accept:"application/json","Content-Type":"application/json",...i}}).then(r=>r.json()).catch(r=>{var s;if((s=r==null?void 0:r.message)!=null&&s.includes("timed out"))return{status:"error",error:{code:"error.api.timed_out"}}})},v=async e=>{const t=await fetch(`${e}&p=1`).catch(()=>{});return(t==null?void 0:t.status)===200?t==null?void 0:t.status:0},x={request:h,probeCobaltTunnel:v};export{x as default};
